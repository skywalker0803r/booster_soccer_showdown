# 專家數據收集操作說明文件

## 概述

`tmp_rovodev_collect_data_append.py` 是一個專家數據收集腳本，用於收集人類專家操控 T1 雙足機器人進行足球任務的示範數據。這些數據將用於訓練模仿學習模型，讓AI學會像人類專家一樣控制機器人。

## 腳本功能說明

### 主要功能
1. **遠程操控機器人**: 通過鍵盤控制T1機器人在足球環境中的動作
2. **數據收集**: 實時記錄機器人的狀態（state）、動作（action）和任務完成標記
3. **數據追加**: 可以在現有數據集基礎上繼續收集，無需重新開始
4. **多任務支持**: 支持三種足球任務的數據收集

### 支援的任務類型
- **GoaliePenaltyKick**: 守門員撲救點球任務
- **ObstaclePenaltyKick**: 帶障礙物的點球任務  
- **KickToTarget**: 踢球到目標位置任務

## 操作流程

### 1. 啟動腳本
```bash
python tmp_rovodev_collect_data_append.py --env LowerT1GoaliePenaltyKick-v0 --data_set_directory ./data/dataset_kick.npz
```

### 2. 鍵盤控制說明
腳本啟動後，您可以使用以下鍵盤控制：

**SE3 位置控制 (Position Control):**
- `W/S`: 前進/後退 (X軸移動)
- `A/D`: 左移/右移 (Y軸移動)  
- `Q/E`: 上升/下降 (Z軸移動)

**SE3 旋轉控制 (Rotation Control):**
- `I/K`: 繞X軸旋轉 (Roll)
- `J/L`: 繞Y軸旋轉 (Pitch)
- `U/O`: 繞Z軸旋轉 (Yaw)

**系統控制:**
- `R`: 重置環境到初始狀態
- `ESC`: 退出並保存數據

### 3. 數據收集過程
1. 環境重置，開始新的episode
2. 操作員通過鍵盤控制機器人移動
3. 系統實時記錄：
   - 機器人當前狀態 (observations)
   - 執行的動作指令 (actions)
   - episode結束標記 (done)
4. 當任務完成或失敗時，episode結束
5. 重複步驟1-4，持續收集多個episode的數據

## 數據結構詳解

### State (觀察狀態) - 維度: (89,)

收集到的state是一個89維的向量，包含以下信息：

#### 機器人本體狀態 (0-23維)
- **關節位置 (0-11維)**: 12個關節的當前角度位置
  - 代表機器人各關節的當前姿態
- **關節速度 (12-23維)**: 12個關節的角速度
  - 代表關節運動的速度信息

#### 傳感器數據 (24-38維)  
- **投影重力 (24-26維)**: 機器人坐標系下的重力向量
  - 用於感知機器人的傾斜狀態
- **基座角速度 (27-29維)**: 機器人軀幹的旋轉速度
  - Roll, Pitch, Yaw 三個方向的角速度
- **加速度計數據 (30-32維)**: 機器人的線性加速度
- **速度計數據 (33-35維)**: 機器人的線性速度

#### 環境感知信息 (36-85維)
- **球門位置 (36-41維)**:
  - 己方球門相對機器人位置 (36-38維)
  - 對方球門相對機器人位置 (39-41維)
- **球門相對於球的位置 (42-47維)**:
  - 己方球門相對球位置 (42-44維)  
  - 對方球門相對球位置 (45-47維)
- **足球狀態 (48-56維)**:
  - 足球相對機器人位置 (48-50維)
  - 足球線性速度相對機器人 (51-53維)
  - 足球旋轉速度相對機器人 (54-56維)
- **隊伍信息 (57維)**: 機器人所屬隊伍標識
- **守門員狀態 (58-69維)**:
  - 己方守門員位置和速度 (58-63維)
  - 對方守門員位置和速度 (64-69維)
- **目標位置 (70-75維)**: 
  - 目標點相對機器人位置 (70-72維)
  - 目標點速度相對機器人 (73-75維)
- **防守球員位置 (76-85維)**: 場上防守球員的位置信息

#### 任務類型標識 (86-88維)
- **任務one-hot編碼 (86-88維)**:
  - [1,0,0]: GoaliePenaltyKick
  - [0,1,0]: ObstaclePenaltyKick  
  - [0,0,1]: KickToTarget

### Action (動作指令) - 維度: (12,)

動作向量是12維，對應12個關節的控制指令：

#### 關節動作映射
1. **左腿關節 (0-5維)**:
   - 0: 左髖関節Yaw (左右轉動)
   - 1: 左髖関節Roll (內外展)  
   - 2: 左髖関節Pitch (前後擺動)
   - 3: 左膝関節Pitch (膝蓋彎曲)
   - 4: 左踝関節Pitch (腳踝上下)
   - 5: 左踝関節Roll (腳踝內外翻)

2. **右腿關節 (6-11維)**:
   - 6: 右髖関節Yaw
   - 7: 右髖関節Roll  
   - 8: 右髖関節Pitch
   - 9: 右膝関節Pitch
   - 10: 右踝関節Pitch
   - 11: 右踝関節Roll

#### 動作值範圍
- **數值範圍**: [-1.0, 1.0]
- **物理意義**: 相對於默認姿態的關節角度調整量
- **控制方式**: PD控制器將這些動作值轉換為實際的關節力矩

### Done (完成標記) - 維度: (1,)
- **True**: 當前episode結束（任務完成或失敗）
- **False**: episode仍在進行中

## 數據品質要求

### 專家操作建議
1. **平穩控制**: 避免急劇的動作變化，保持機器人穩定
2. **任務導向**: 專注於完成具體的足球任務目標
3. **多樣性**: 嘗試不同的策略和路徑，增加數據多樣性
4. **質量優先**: 寧可收集少量高質量數據，也不要大量低質量數據

### 數據收集目標
- **每個任務**: 建議收集至少100-200個成功的episode
- **總時間步**: 每個任務至少10,000-20,000個時間步
- **成功率**: 專家示範的成功率應該達到80%以上

## 常見問題與解決方案

### 1. 機器人不響應控制
- 檢查鍵盤輸入是否正確
- 確認環境窗口處於激活狀態
- 檢查環境是否正常初始化

### 2. 動作過於敏感或遲鈍
- 調整 `pos_sensitivity` 和 `rot_sensitivity` 參數
- 建議值: pos_sensitivity=1.0, rot_sensitivity=5.0

### 3. 數據保存失敗
- 確認 `data` 文件夾存在
- 檢查磁盤空間是否足夠
- 確認文件權限設置正確

### 4. Episode 過早結束
- 檢查機器人是否跌倒
- 注意避免碰撞邊界
- 確保任務目標明確

## 技術細節

### 座標系統
- **機器人座標系**: 以機器人中心為原點，前方為X軸正方向
- **世界座標系**: 場地中心為原點的全局座標系
- **相對座標**: 大部分觀測值都是相對於機器人的位置

### 控制頻率
- **環境頻率**: 100Hz (每秒100步)
- **控制頻率**: 20Hz (每5步更新一次動作)
- **數據記錄**: 每個環境步都記錄數據

### 數據預處理
- **狀態歸一化**: 部分狀態值經過歸一化處理
- **四元數處理**: 旋轉信息經過四元數變換
- **重力投影**: 重力向量投影到機器人坐標系

## 數據後續處理

收集到的數據將用於：
1. **行為克隆 (Behavioral Cloning)**: 直接學習專家的狀態-動作映射
2. **逆強化學習**: 學習專家的獎勵函數
3. **軌跡優化**: 改進機器人的運動軌跡
4. **策略蒸餾**: 將專家知識傳遞給學習算法

## 注意事項

1. **數據一致性**: 確保同一任務的數據收集使用相同的環境設置
2. **標記清晰**: 記錄每個episode的任務類型和結果
3. **備份重要**: 定期備份已收集的數據，防止意外丟失
4. **質量檢查**: 定期檢查數據質量，剔除異常數據

## 聯繫方式

如果在數據收集過程中遇到技術問題，請聯繫：
- 技術負責人: [skywalker0803r@gmail.com]
- 項目文檔: 參考項目根目錄的其他文檔文件

---

**重要提醒**: 專家數據的質量直接影響後續AI模型的性能，請認真對待每一次操作，確保收集到高質量的示範數據。